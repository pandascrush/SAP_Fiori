//@ui5-bundle <id>/Component-preload.js
sap.ui.predefine("<id>/Component", ["sap/ui/core/UIComponent"],function(t){"use strict";return t.extend("sap.ui.demo.walkthrough.Component",{metadata:{manifest:"json"},init:function(){t.prototype.init.apply(this,arguments);this.getRouter().initialize()}})});
sap.ui.predefine("<id>/controller/View1.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t,a){"use strict";return e.extend("sap.ui.demo.walkthrough.controller.View1",{onInit:function(){var e=new a({metrics:[{key:"Select the Option",text:"Select the Option"},{key:"Balnc_Prodn_value",text:"Balnc Prodn Value"},{key:"Colln",text:"Collection"},{key:"Paymt",text:"Payment"}]});this.getView().setModel(e)},onFileChange:function(e){var t=this.byId("fileUploader");var a=t.getValue();this.byId("fileNameText").setText(a)},_isValidFile:function(e){var t=["csv"];var a=e.name.split(".").pop().toLowerCase();return t.includes(a)},onSubmit:function(){var e=this.byId("fileUploader");var a=e.oFileUpload.files[0];if(a){this._processFile(a)}else{t.show("Please upload a file first.")}},_processFile:function(e){var t=this;var a=new FileReader;a.onload=function(e){var a=e.target.result;console.log("File content:",a);var r=t._csvToJson(a);console.log("Converted JSON data:",r);t._jsonData=r;t._displayDataInTable(r)};a.onerror=function(e){console.error("Error reading file:",e)};a.readAsText(e)},_csvToJson:function(e){var t=e.split("\n");var a=[];var r=t[0].split(",");for(var i=1;i<t.length;i++){var n={};var o=t[i].split(",");if(o.length===1&&o[0].trim()===""){continue}for(var s=0;s<r.length;s++){var l=r[s].trim();var c=o[s]?o[s].trim():"";if(l&&c){n[l]=c}}a.push(n)}return a},onFetchData:function(){var e=this;var a="http://localhost:3003/finaldata.json";jQuery.ajax({url:a,method:"GET",dataType:"json",success:function(t){console.log("Fetched data from API:",t);var a=e._mergeDataByDate(e._jsonData,t);console.log("Merged data:",a);e._jsonData=a;e._displayDataInTable(a);e.byId("metricSelect").setVisible(false);e.byId("combinedChartVBox").setVisible(false)},error:function(e){console.error("Error fetching data from API:",e);t.show("Error fetching data from API.")}})},_mergeDataByDate:function(e,t){var a=new Map;e.forEach(function(e){a.set(e.Date,e)});t.forEach(function(e){var t=a.get(e.Date);if(t){Object.keys(e).forEach(function(a){if(a!=="Date"){t[a]=e[a]}})}else{a.set(e.Date,e)}});return Array.from(a.values())},_displayDataInTable:function(e){var a=this.byId("dataTable");a.destroyColumns();a.destroyItems();if(e.length>0){var r=Object.keys(e[0]);r.forEach(function(e){a.addColumn(new sap.m.Column({header:new sap.m.Label({text:e,wrapping:true,tooltip:e}),width:"auto",minScreenWidth:"Small"}))});e.forEach(function(e){var t=r.map(function(t){return new sap.m.Text({text:e[t]})});a.addItem(new sap.m.ColumnListItem({cells:t}))});a.setVisible(true)}else{t.show("No data to display.")}},onShowSelectBox:function(){this.byId("metricSelect").setVisible(true);this.byId("combinedChartVBox").setVisible(true)},onSeeChart:function(){if(!this._jsonData){t.show("Please upload a file first.");return}var e="Net Price (Bar)";var a="Sales Plan Value (Line)";var r=this._selectedMetric?this._selectedMetric+" (Line)":null;if(!this._chart){this._displayCombinedChart(this._jsonData,e,a,null)}else if(r){this._addAdditionalLineChart(this._jsonData,r)}this.byId("metricSelect").setVisible(true)},onSelectChange:function(e){var t=e.getSource().getSelectedItems();var a=t.map(function(e){return e.getKey()});this._selectedMetrics=a;if(this._jsonData){this._displayCombinedChart(this._jsonData,this._selectedMetrics)}},_displayCombinedChart:function(e,t){var a=e.map(function(e){return e.Date});var r=e.map(function(e){return e.Net_Price});if(!Array.isArray(t)){t=[]}var i=[{type:"bar",label:"Net Price",data:r,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1},{type:"line",label:"Sales_Plan_value (Line)",data:e.map(function(e){return e.Sales_Plan_value||0}),borderColor:"rgba(54, 162, 235, 1)",fill:false}];t.forEach(function(t){i.push({type:"line",label:t+" (Line)",data:e.map(function(e){return e[t]||0}),borderColor:"rgba(255, 159, 64, 1)",fill:false})});var n=this.byId("combinedChartVBox");if(n.getItems().length===0){var o=new sap.ui.core.HTML({content:"<canvas id='combinedChart' style='width: 100%; height: 400px;'></canvas>"});n.addItem(o)}setTimeout(function(){var e=document.getElementById("combinedChart").getContext("2d");if(this._chart){this._chart.destroy()}this._chart=new Chart(e,{type:"bar",data:{labels:a,datasets:i},options:{responsive:true,scales:{y:{beginAtZero:true}},onClick:function(e,t){if(t.length>0){var a=t[0];var r=a._index;var i=this._chart.data.labels[r];console.log("Clicked Date:",i);this._displayFilteredDataInTable(i)}}.bind(this)}});this._chart.update()}.bind(this),500);n.setVisible(true)},_addAdditionalLineChart:function(e,t){var a=e.map(function(e){return e.Date});var r=e.map(function(e){return e[this._selectedMetric]}.bind(this));if(this._chart){this._chart.data.datasets.push({type:"line",label:t,data:r,borderColor:"rgba(54, 162, 235, 1)",fill:false});this._chart.update()}},_displayFilteredDataInTable:function(e){var a=this._jsonData.filter(function(t){return t.Date===e});var r=this.byId("selectedDataTable");r.destroyColumns();r.destroyItems();if(a.length>0){var i=Object.keys(a[0]);i.forEach(function(e){r.addColumn(new sap.m.Column({header:new sap.m.Label({text:e,wrapping:true,tooltip:e}),width:"auto",minScreenWidth:"Small"}))});a.forEach(function(e){var t=i.map(function(t){return new sap.m.Text({text:e[t]})});r.addItem(new sap.m.ColumnListItem({cells:t}))});r.setVisible(true)}else{t.show("No data to display.")}}})});
sap.ui.predefine("<id>/index", ["sap/ui/core/mvc/XMLView"],function(e){"use strict";e.create({viewName:"sap.ui.demo.walkthrough.view.View1"}).then(function(e){e.placeAt("content")})});
sap.ui.require.preload({
	"<id>/manifest.json":'{"_version":"1.1.0","start_url":"<startUrl>","sap.app":{"_version":"1.1.0","id":"<id>","type":"application","i18n":"<i18nPathRelativeToManifest>","applicationVersion":{"version":"<version>"},"title":"{{<title>}}","tags":{"keywords":["{{<keyword1>}}","{{<keyword2>}}"]},"dataSources":{"<dataSourceAlias>":{"uri":"<uri>","settings":{"localUri":"<localUri>"}}}},"sap.ui":{"_version":"1.1.0","icons":{"icon":"<icon>","favIcon":"<favIcon>","phone":"<phone>","phone@2":"<phone@2>","tablet":"<tablet>","tablet@2":"<tablet@2>"},"deviceTypes":{"desktop":true,"tablet":true,"phone":true},"supportedThemes":["sap_hcb","sap_bluecrystal"]},"sap.ui5":{"_version":"1.1.0","resources":{"js":[{"uri":"<uri>"}],"css":[{"uri":"<uri>","id":"<id>"}]},"dependencies":{"minUI5Version":"<minUI5Version>","libs":{"<ui5lib1>":{"minVersion":"<minVersion1>"},"<ui5lib2>":{"minVersion":"<minVersion2>"}},"components":{"<ui5component1>":{"minVersion":"<minComp1Version>"}}},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","uri":"<uriRelativeToManifest>"},"":{"dataSource":"<dataSourceAlias>","settings":{}}},"rootView":"<rootView>","handleValidation":false,"config":{},"routing":{},"extends":{"component":"<extendedComponentId>","minVersion":"<minComp1Version>","extensions":{}},"contentDensities":{"compact":false,"cozy":false}},"sap.platform.abap":{"_version":"1.1.0","uri":"<uri>"},"sap.platform.hcp":{"_version":"1.1.0","uri":"<uri>"}}',
	"<id>/view/View1.view.xml":'<mvc:View\r\n    xmlns="sap.m"\r\n    xmlns:mvc="sap.ui.core.mvc"\r\n    xmlns:core="sap.ui.core"\r\n    xmlns:unified="sap.ui.unified"\r\n    controllerName="sap.ui.demo.walkthrough.controller.View1"\r\n><VBox class="sapUiSmallMargin"><Label text="Upload your file" labelFor="fileUploader" /><unified:FileUploader id="fileUploader" name="myFile" fileType="csv" change="onFileChange" /><Text id="fileNameText" text="" /><Button text="Submit" press="onSubmit" type="Emphasized" /><Button id="fetchDataButton" text="Fetch Data from API" press="onFetchData" type="Emphasized" /><MultiComboBox id="metricSelect"\r\n            items="{/metrics}"\r\n            visible="false"\r\n            selectionChange="onSelectChange"><items><core:Item key="{key}" text="{text}" /></items></MultiComboBox><Button id="seeChartButton" text="See Chart" press="onSeeChart" type="Emphasized" /><VBox id="combinedChartVBox" visible="false"></VBox><Table id="selectedDataTable" inset="false" visible="false"><columns></columns><items><ColumnListItem></ColumnListItem></items></Table></VBox></mvc:View>'
});
//# sourceMappingURL=Component-preload.js.map
